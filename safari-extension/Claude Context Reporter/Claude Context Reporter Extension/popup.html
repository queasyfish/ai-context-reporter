<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Context Reporter</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="popup">
    <div class="tabs">
      <button class="tab-btn active" data-view="reports">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
        </svg>
        Reports
        <span class="tab-badge" id="reports-badge">0</span>
      </button>
      <button class="tab-btn" data-view="inspect" id="inspect-btn" title="Deep Inspection Mode">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <polygon points="10 8 16 12 10 16 10 8"/>
        </svg>
      </button>
      <button class="tab-btn" data-view="settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
    </div>

    <main class="content">
      <!-- Reports View -->
      <div id="reports-view" class="view active">
        <div class="reports-header">
          <span class="reports-title">Saved Reports</span>
          <div class="header-buttons">
            <button id="export-all-btn" class="header-btn export-all-btn" title="Export all reports">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                <path d="M8 10V2M8 10L5 7M8 10L11 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M2 12V13C2 13.5523 2.44772 14 3 14H13C13.5523 14 14 13.5523 14 13V12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              Export
            </button>
            <button id="clear-btn" class="header-btn clear-all-btn" title="Clear all reports">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                <path d="M3 4H13M6 4V3C6 2.44772 6.44772 2 7 2H9C9.55228 2 10 2.44772 10 3V4M12 4V13C12 13.5523 11.5523 14 11 14H5C4.44772 14 4 13.5523 4 13V4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Clear
            </button>
          </div>
        </div>

        <div id="empty-state" class="empty-state">
          <div class="empty-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <path d="M3 9h18M9 21V9"/>
            </svg>
          </div>
          <p>No reports yet</p>
          <span class="empty-hint">Right-click any element and select<br>"Capture for AI Context"</span>
        </div>

        <div id="drag-hint" class="drag-hint hidden">
          Drag reports to your IDE, Finder, or terminal
        </div>

        <ul id="reports-list" class="reports-list hidden"></ul>
      </div>

      <!-- Settings View -->
      <div id="settings-view" class="view">
        <div class="settings-section">
          <div class="settings-title">Project Mappings</div>
          <p class="settings-description">Route reports to project folders based on URL patterns.</p>

          <div id="mappings-list" class="mappings-list">
            <p class="empty-state-small">No project mappings configured</p>
          </div>

          <button id="add-mapping-btn" class="add-mapping-btn">+ Add Project Mapping</button>
        </div>

        <div class="settings-section">
          <div class="settings-title">Default Behavior</div>
          <p class="settings-hint">
            When no project matches, reports are organized by domain:<br>
            <code>ai-agent-reports/localhost-3000/</code><br>
            <code>ai-agent-reports/github-com/</code>
          </p>
        </div>
      </div>
    </main>
  </div>

  <!-- Mapping Dialog -->
  <dialog id="mapping-dialog">
    <div class="dialog-header">
      <h3 class="dialog-title">Project Mapping</h3>
    </div>
    <form method="dialog" id="mapping-form">
      <div class="dialog-body">
        <input type="hidden" id="mapping-id">

        <div class="form-group">
          <label class="form-label" for="mapping-name">Project Name</label>
          <input type="text" id="mapping-name" class="form-input" placeholder="My React App" required>
        </div>

        <div class="form-group">
          <label class="form-label" for="mapping-patterns">URL Patterns (one per line)</label>
          <textarea id="mapping-patterns" class="form-textarea" placeholder="localhost:3000&#10;*.myapp.com" required></textarea>
          <p class="form-hint">Supports: exact, wildcards (*.example.com), ports (localhost:*)</p>
        </div>

        <div class="form-group">
          <label class="form-label" for="mapping-folder">Folder Name</label>
          <input type="text" id="mapping-folder" class="form-input" placeholder="my-react-app" required>
        </div>
      </div>
      <div class="dialog-footer">
        <button type="button" class="dialog-btn dialog-btn-secondary" id="mapping-cancel">Cancel</button>
        <button type="submit" class="dialog-btn dialog-btn-primary">Save</button>
      </div>
    </form>
  </dialog>

  <template id="report-template">
    <li class="report-item" draggable="true">
      <div class="report-meta">
        <span class="report-element"></span>
        <span class="report-time"></span>
      </div>
      <p class="report-comment"></p>
      <div class="report-url"></div>
      <div class="report-actions">
        <button class="action-btn export-btn" title="Export to ai-agent-reports folder">
          <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
            <path d="M8 10V2M8 10L5 7M8 10L11 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 12V13C2 13.5523 2.44772 14 3 14H13C13.5523 14 14 13.5523 14 13V12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
        <button class="action-btn copy-btn">Copy</button>
        <button class="action-btn delete-btn">Delete</button>
      </div>
    </li>
  </template>

  <script src="popup.js"></script>
</body>
</html>
